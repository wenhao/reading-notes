## 持续交付2.0 业务引领的DevOps精要

### 第1章 持续交付2.0

1. 敏捷软件开发方法强调发挥人的主观能动性，提倡面对面沟通、拥抱变化、通过迭代和增量开发尽早交付有价值的软件。P2
2. DevOps的萌芽源于2008年8月敏捷大会多伦多的一个临时话题“敏捷基础设施（Agile Infrastructure）”。2009年10月，Patrick在比利时的根特组织了一个“DevOpsDays”社区会议，并正式启用了“DevOps”这个术语。P3
3. DevOps是一种概念集合的代称，虽然并非全部都是新概念，但它们已经催化为一种运动，并迅速在整个社区中传播。DevOps是运维工程师和开发工程师参与整个服务生命周期（从设计到开发再到生产支持）的一组实践。并提出，DevOps应该倡导运维人员更多地使用和开发人员使用的相同技术来进行系统运维工作。P3
4. DevOps是一种软件工程文化和实践，旨在统一整合软件开发和软件运维。DevOps运动的主要特点是强烈倡导对构建软件的所有环节（从集成、测试、发布到部署和基础架构管理）进行全面的自动化和监控。DevOps的目标是缩短开发周期，提高部署频率和更可靠地发布，与业务目标保持一致。P4
5. DevOps并非一个标准、一种模式或者一套固定方法，而是一种IT组织管理的发展趋势，也就是说，通过多种方式打破IT职能部门之间的隔阂，改变IT组织内部的原有角色与分工变化，甚至范围更大，会影响到相关的业务组织。P4
6. JezHumble说：“持续交付是一种能力，也就是说，能够以可持续方式，安全快速地把代码变更（包括特性、配置、缺陷和实验）部署到生产环境上，让用户使用。”本书将这一定义称为“持续交付1.0”。P5
7. 持续交付1.0关注与“从提交代码到产品发布”的过程。P7
8. 1996年，Womack、Jones和Roos在《精益思想》一书中指出，精益思想是指导企业根据用户需求，定义企业生产价值，按照价值流来组织全部生产活动，使价值在生产活动之间流动起来，由需求拉动产品的生产，从而识别整个生产过程中不经意间产生的浪费，并消除之。P8
9. “持续交付2.0”是一种产品研发管理思维框架。它由两个相连的环组成：第一个环为“探索环”，其主要目标是识别和定义业务问题，并制定出最小可行解决方案进入第二个环；第二个环为“验证环”，其主要目标是以最快速度交付最小可行方案，可靠地收集真实反馈，并分析和验证业务问题的解决效果，以便决定下一步行动。P10
10. 探索环包含4个可持续循环步骤，分别是提问、锚定、共创和精炼。P10
    * 提问，即定问题。如果问题无法清晰定义，那么找到的答案自然就会有偏差。因此，在寻找答案之前，应该先清晰地定义问题。
    * 锚定，即定义结果目标指示器。针对问题进行信息收集，经过分析，去除干扰信息，识别问题假设，得到适当的衡量指标项，并用其描述现在的状况，同时讨论并定义我们接下来的行动欧期望的结果。
    * 共创，即共同探索和创造解决或验证该问题的多种具有可行性的解决方案。
    * 精炼，即对所有的可行试验方案进行选择，找到最小可行性解决方案，它既可能是单个方案，也可能是多个方案的组合。
11. 验证环也包含4个可持续循环的步骤，分别是构建、运行、监测和决策。P10
    * 构建：将最小可行性解决方案准确地转换成符合质量要求的软件包。
    * 运行：是指将达到质量要求的软件包部署到生产环境或交到用户手中，并使之为用户提供服务。
    * 监测：是指收集生产系统中产生的数据，对系统进行监控，确保其正常运行。同时将业务数据以适当的形式及时呈现出来。
    * 决策：是指将收集到的数据信息与探索环得出的对应目标进行对比分析，做出决策，确定下一步的方向。
12. “持续交付2.0”是指企业能够以可持续发展的方式，在高质量、低成本及无风险的前提下，不断缩短持续交付“8”字环周期，从而与企业外部频繁互动，获得及时而且真实的反馈，最终创造更多客户价值的能力。下面逐一介绍缩短持续交付“8”字环周期的4个核心工作原则。P11
    * 坚持少做：我们应该抵住“通过大量计划来构建最佳功能”的诱惑，坚持少做，想办法对新创意尽早验证。
    * 持续分解问题：在实施解决方案之前，通过对问题的层层分解，可以让团队更了解业务，更早识别出风险。
    * 坚持快速反馈：只有通过快速反馈，我们才能尽早了解所完成工作的质量和效果。
    * 持续改进并衡量：无论做了什么样的改进，如果无法以某种方式衡量它的结果，就无法证明真的得到了改进。在着手解决每个问题之前，我们都要找到适当的衡量方式，并将其与对应的功能需求放在同等重要的位置上，一起完成。
13. “持续交付2.0”建立在“持续交付1.0”的“可持续地快速发布软件服务”及精益创业的“最小化可行产品”两种理念基础之上，强调要以业务为导向，从一开始就将业务问题进行分解，并通过不断的科学探索与快速验证，减少浪费的同时，快速找到正确的业务前进方向，简称为“双环模型”。P13

### 第2章 价值探索环

1. “什么是价值？”管理大师彼得德鲁克说，“价值只能由企业外部的客户来定义。” P14
2. 持续交付“8”字环：P14
    * 探索环：提问、锚定、共创、精炼。
    * 验证环：构建、运行、监测、决策。
3. 探索环（Discovery Loop）是指团队通过一系列工作环节，能够识别和定义业务问题，制定相应的衡量指标，并找出低成本且可快速验证的最小可行解决方案（Minimum Viable Solution）。这是一个理解真实需求、判断优先级、再评估需求的过程，具体包括以下4个环节。P15
    * 提问：通过有针对性的提问与讨论，找出团队期望达成的业务目标或者希望解决的业务本质问题。
    * 锚定：针对该问题进行信息收集，经过分析，去除干扰信息，得到适当的指标项，并用其描述现在的状况，以及我们希望的结果或状态。
    * 共创：通过深入讨论，找到所有可能的解决方案。它是一个深入理解和验证问题的环节。
    * 精炼：结合实际情况，进行评估，筛选出最小可行性解决方案或方案的集合，以作为验证环的输入。等待它的真实反馈，再做价值判断。
4.  探索环中的提问环节要求不仅仅是找到“实现什么”以及“如何实现”，更是要了解客户需求背后要解决的真正问题“为什么要实现”，以便规划更加方便快捷的验证方案或解决方案。P16
5. 在“提问”这一环节中，组织者需要注意以下4点。P17
    * 问题域的提出方案及解决方案的提供方代表尽量到场，参与讨论。
    * 多问几个“为什么”。尽量避免因为感觉自己熟悉这个问题域，而过早地放弃探索。
    * 在条件允许的情况下，尽可能收集数据信息，以便作为问题理解和分析的佐证。
    * 移情，使用同理心。设身处地地站在客户或问题提出方的角度思考问题，还原客户问题的场景。
6. “锚定”是设定及目标分解的讨论过程，其目的是确定要达成的目标以及可以衡量它的指标，并能够指导后续的共创与精炼活动。P19
7. 对于目标的选择，应该遵循两点：一是识别价值指标，而非虚荣指标；而是指标应该可衡量且可获取，易于客观对比。P19
8. 共创就是指：当我们制定了想要达到的目标后，团队为设法验证或达成目标而找出多种可行性解决方案的过程。共创要在理解问题和制定目标之后进行，否则会因为缺少目标约束，使得解决方案容易过于发散。这一环节的产出应该是很多带有量化指示器的解决方案。P19
9. 量化式影响地图按“角色-影响-方案-两个”的顺序进行讨论。量化式影响地图的具体制作步骤如下所示。P20
    * 角色：列出该问题域所涉及的人或角色。
    * 影响：针对每类人或角色，思考他们有哪些途径可以影响该问题的解决（既可能是积极的影响，也可能是消极的影响）。
    * 方案：针对每一种途径，讨论并列出所有可能影响该问题的解决方案。
    * 量化：如何可能，尽量为每个解决方案定义一个可衡量的指标项。
10. 用户旅行地图是指以可视化方式，将用户与产品或服务之间的互动，按业务流分阶段呈现出来。用户旅行地图通常包括以下4部分。P21
    * 用户接触点：旅程中的重要关键时刻（如短信消息、软件操作界面等）。
    * 接触阶段：将整个旅程按顺序划分成不同的阶段（例如商品查询、下单、付款等）。
    * 用户痛点：在用户与系统服务的互动过程中，对什么感到不足。
    * 用户情绪：在旅程中的每一个阶段，有哪些情绪变化。
11. 用户旅行地图的制作步骤如下：P21
    * 定义用户：明确制定为某一类用户定义用户旅行地图。
    * 定义任务或阶段：在这些任务或阶段中，会有哪些不同事件发生。
    * 用户与服务接触点的互动行为：在不同事件发生时，用户如何操作，操作顺序如何。
    * 用户的动机：用户在每个操作背后会产生什么样的想法，有什么痛点。
    * 用户的心理：在每个操作中，用户心理会有哪些变化，情绪会如何起伏。
12. 精炼环节就是对共创环节中得出的众多方案进行评估，从中筛选出团队认为最小可行性解决方案的过程。评估因素包括备选方案的实施成本、时间与人力、效果反馈周期，以及该方案对业务目标的影响程度。P22
13. 装饰窗方法是指为新功能预留一个“入口”，让用户能够看到，但实际上并没有真正实现其功能。就像一个装饰性的窗户。这是一个钟了解用户喜好的方法，其目的是利用最小成本，来验证用户是否喜欢某个功能，以及其紧迫程度，为是否研发后续更全面的解决方案提供数据支持。P27
14. 最小可行特性法是指在产品从1到n的过程中，寻找用户可直接感知到的需求假设作为产品的最小可行特性优先开发的方法，已经可能少的成本快速增加或修改某个产品特性，让用户使用，收集真实反馈，专注于验证功能改进，同时也可提升用户使用体验。P29
15. 特区法是指在特定用户范围内进行试验，以验证某个新功能的有效性。这样，即使新功能无效或者效果不好，也不会影响特区外的用户。这种方法对于资源有限、成本敏感，但希望为用户提供良好服务的业务来说，是非常有效的方法。P30
16. 定向探索发是指针对具有某种特定行为的特定用户群体，依据该用户的具体行为模式，设计调查提纲，有针对性地探索其行为背后的动机。这种定向探索与一般用户访谈的不同点在于：团队已经掌握了被访谈对象的具体行为（包括行为细节与发生时间等），以事实为依据，进行定向式的探索发现，而非宽泛的通用提问。P30
17. 稻草人法就是指：不开发任何真实的功能，只假装这个功能已经完成了， 并向用户展示该功能的真实效果，从而得到用户的真实反馈。这种方法与装饰窗方法的区别在于它让用户真实地感受到了功能提供的结果，而事实上并没有这个功能。P31
18. 最小可行产品法通常是产品从0到1的过程中使用。它是以尽可能少的成本快速开发产品的核心功能，并找到用户，收集真实反馈，验证真实的用户需求，已确定新产品方向和形态的方法，其目标是找到合适的产品形态。P32
19. 实施注意事项：P32
    * 多角色参与探索
        * 探索环涉及业务领域的很多方面，包括问题的发现与定义、目标与衡量的制定等多种产物，而不仅仅是产出一个功能需求列表。因此，建议与业务领域问题及产品解决方案相关的各类角色都能够参与其中。而且，参与其中的每个人均应该对上述内容有所贡献。
    * 存在往复过程
        * 探索过程中存在很多的不确定性，因此4个环节中也必然存在一定的反复与循环。这是正常现象，尤其是当业务领域比较复杂、涉及环节比较多，业务流程中所涉及的角色也比较多时，更容易发生。很可能在讨论某个问题的可行解决方案时，会发现另一个隐藏的重要业务问题。探索过程强调“度量与量化”。
    * 风险不是等价的
        * 仅需对那些被评估为风险较大的假设进行验证方案设计，并尽量以较低成本进行验证。而对于哪些低风险项，团队要在设计解决方案时，提出一些衡量指示器，并在方案执行后，一同收集相关的数据结果。
    * 上帝视角
        * 由于在某个领域工作时间较长，有些人认为自己非非常了解用户，常常“闭门造车”，并美其名曰“注重用户体验”。然后，当产品上线后缺发现，用户对产品功能有很大的意见。
            * “纸上原型交互”方法，及时将 系统交互原型打印到纸上，邀请用户试验，观察用户的行为，并与用户沟通，从而得到用户反馈，当然现在有很多电子工具支持这种需求。
            * “MVP”法，即快速推出“面向标注人”的简化考试版本，仅实现其中一种类型标注的在线考试功能，而题库以及出题人相关的功能均暂时先由内部人员用手工方式进行准备。
20. 唯数字论：P34
    * 拿到指标数据之后，我们仍旧需要仔细思考，分析各项数据背后的原因，思考未来的发展趋势，甚至提出一些我们没有完全把握的问题或方向，再次开启探索环。
21. 蛇形效应：P34
    * 团队针对问题制定了一些列的试验方案A，并开始执行验证。但在还没有执行完成或得到结果之前，团队又有了新的想法和方案B，并且对新的想法兴奋不已，马上开始执行方案B。没有多久，可能又想到了一个新的方向，如此循环。

### 第3章 快速验证环

1. 现代管理学支付彼得德鲁克曾告诫我们，“对所有的企业来说，我们都应该记住的最重要的一点就是：结果只存在于企业的外部……在企业的内部，只有成本。”也就是说，在外面创造的产品或服务真正被用户使用之前，我们只能衡量成本，预测价值。只有产品或服务被用户消费，并且最终能够变现，才能证明其价值的存在。P36
2. 进入验证环的基本前提是“团队已达成共识，所选的方案是当前所处环境下，验证或解决业务领域问题的最佳方式”。验证换的目标就是借助各种方法与工具，让质量可靠的解决方案以最快的速度到达客户手中，从而收集并分析真实的反馈。P36
3. 探索环，它包含4个环节，分别是构建、运行、监测和决策。P37
    * 构建：是指根据非数字化描述，将解决方案准确地编程达成到质量要求且可运行的软件包。
    * 运行：是指将达到质量要求的软件包部署到生产环境或交到用户手中，并使之为用户提供服务。
    * 监测：是指收集生产系统中产生的数据，对系统进行监控，确保其正常运行。同时将业务数据以适当的形式及时呈现出来。
    * 决策：是指将收集到的数据信息与探索环得出的对应目标进行对比分析，做出决策，确定下一步的方向。
4. 构建：如何快速将人们头脑中的解决方案编程可以运行的高质量软件包，一直是软件工程领域的一个难题。这是验证环内不确定因素最多的一个环节。时间盒管理、工作任务分解和持续验证是应对这种不确定性的好方法。P37
    * 时间盒管理
        * 时间盒方法（timeboxing）是一种常见的管理方法，很多项目管理方法中都使用时间盒管理。时间盒方法通常会涉及交付物、交付质量和截止时间。通过建立时间盒管理机制，可以了解当前的项目状态（进度与质量），及时发现风险，制定对策。它可以让团队时刻关注工作产出，及时得到进度和质量反馈。
    * 任务分解
        * 对任务的分解是“持续交付2.0”的核心工作原则之一。在构建环节，常见的两种任务分解是需求拆分和开发任务拆分。
            * 需求拆分：也就是极限编程方法中的用户故事或者Scrum方法中的迭代任务项。通过需求拆分，团队各角色互相交流和提问，使解决方案更加明确清晰，减少二义性。
            * 开发任务拆分：即为了实现某一需求，将其分成多个开发任务，这些开发任务既可以由一人完成，也可以由多人完成。它与需求拆分的不同在于：开发任务完成后，通常无法被其他角色验收。这一过程也是一个需求进一步细化的过程，可以发现更细粒度的风险项。
            * 持续集成：持续验证是指每当完成一项开发任务或需求（包含子需求），就立即对交付质量进行验证，而不是等待多项需求完成后，再进行大批量的质量验证工作。
5. 运行：如何让用户在无感知的情况下完成软件版本的升级更新是互联网时代最为重要的课题。P39
6. 监测：为了能够在第一时间收集到所需数据，团队必须在验证环一开始就讨论并确定验证所需要的数据需求，尽早讨论并定义数据需求规范，制订日志记录标准，建立数据日志元数据，并与相对应的功能需求一并同时实现。否则即使相应的功能特性上线，也无法得到相应的数据而耽误决策。P39
7. 决策是指收到真实的业务数据反馈结果后，根据探索环中已确定的相应衡量指标进行对比分析，从而验证是否符合最初的预期。P39
8. 验证环的工作原则主要包括质量内建、消除等待、尽量并行、监测一切。P39
9. 质量内建就是从生产过程的第一个环节开始，就要注重产出物的质量，并且在每个环节中都要开展质量保障活动，消除因质量问题导致的返工及次品率上升，以此降低最终的质量风险，保障进度。P40
10. 消除等待：P40
    * 通过“拉动”让价值流动起来。
        * 当管理者把重心放到“人”的效率上时，就容易出现所有人都很忙，但产出并没有提升的情况。此时通常会出现中间产物堆积等待现象。要想解决这个问题，需要将管理关注点先从“人”移动到“物”。
    * 任务自动化。
        * 通过运用先进的生产技术，使得环境部署、数据统计这一类事务性操作不再依赖“专家型”人才，而是让每个人在其需要时都能够“自助服务”。那么每个人都可以流畅地工作，而且“专家型”人才被“打断工作”的次数也会减少。
11. 重复事务自动化。P43
12. 监测一切。对生产系统的监测有两个目的，一是要确认软件的确在正常运行，一旦发现异常，我们可以及时采取措施，纠正错误，以免影响用户的使用。而是要及时得到有效业务数据，验证我们在探索环中提出的假设。P43
    * 应用健康监测。
    * 业务监控监测。

### 第4章 持续交付2.0的组织文化

1. “持续交付2.0”强调“持续探索”和“快速验证”，而探索必然会伴随着失败，失败会令人产生挫败感与不安全感。而学习与成长也通常发生在失败之后。这就要求组织必须建立“安全、互相信任和持续改善”的组织文化。P45
2. 在一个高度不确定的环境中，没有人能够保证自己的决策不会出错。如果无法让组织成员感到“失败是安全的”，那么组织成员的行为就会倾向于避免犯错，各扫门前雪，逃避责任，缺少合作。P45
3. 在过去的十年中，很多组织采纳敏捷软件开发方法，但是并没有取得企业所预期的效果，除一些技术改进的原因以外，一个不可忽视的原因就是“相互信任”文化的缺失。当这种文化缺失时，常常会让人感到“产品人员抱怨开发人员不给力”和“开发人员认为产品人员不靠谱”这种潜在的暗示。
4. 持续改善：丰田之所以取得傲人业绩，并不是源于我们可以看到的那些工具和方法而是源于丰田的行为习惯——通过不断地试验而持续改进。持续改善文化的特点是“人人参与”和“时时改善”。“人人参与”是指“持续改善”不应该只是组织中某个角色的责任，而应该是所有人的责任。“时时改善”是指“持续改善”应该是一项常见工作，而不应该只在特定时间或条件下才发生，例如只在事故发生之后才进行分析和改进。P46
5. Google建立工程师质量文化，它是做法也可以总结为以下4步：P49
    * 第一步：定义想要做的事情。
        * 提高代码质量，减少生产问题，减少手工测试工作量，快速发布软件。
    * 第二步：定义期望的做事方法。
        * 开发团队编写自动化测试。
        * 主动运行自动化测试用例。
        * 做代码评审。
    * 第三步：提供相应的培训。
        * 在公司范围内组织代码设计与自动化屙屎培训。
        * 为每个团队指派自动化测试教练，帮助团队提高自动化测试技能。
    * 第四步：做些必须的事情来强化哪些行为。
        * 建立团队测试认证机制，共分3个大级别，12个子级，用于评估每个软件产品团队的测试成熟度。通过每个季度统计各级别上的团队数量分布，来评估自动化测试文化在公司内部的进展程度。
        * 建立自动化测试组合测试教练组，帮助团队提升自动化测试能力。
        * 建立代码评审资质证书。
        * 代码合入版本仓库之前强制做代码评审。
        * 代码评审之前，必须运行自动化测试用例，并提交报告给代码评审者。
6. “价值导向，快速验证，持续学习”作为行动原则。P51
7. 度量指标的4类属性。P56
    * 引领性指标与滞后性指标
        * 引领性指标是指那些对达成预定目标有着重要作用的指标。第一，它具有预见性；第二，团队成员可以影响这些指标。
        * 滞后性指标是指那些为了达成最重要目标的跟踪性指标，如销售收入、利润率、市场份额、客户满意度等研究分析都属于滞后性指标。
    * 可观测性指标与可行动性指标
        * 可观测性指标是指可以被客观观测到，但无法通过直接行动来改变的指标。可行动性指标是指在能力可触达范围内，通过团队努力，可以设法直接改变的指标。
8. 度量的目标是改善。度量是一柄双刃剑，对可行动性的过程指标来说，“你衡量什么，就会得到什么”，但并不一定是以你想要的方式达成的。P57
9. 《丰田套路：转变我们对领导力与管理的认知》一书中介绍了一种“改善套路”，它包含4个阶段，以循环方式不断重复：P58
    * 明确方向或挑战。
    * 掌握当前状态。
    * 建议下一个目标状态。
    * 迭代式迈向目标状态。

### 第5章

1. 亚马逊公司CEO贝索斯认为不应该在增加沟通，而是应该减少沟通，即增加下哦团队内部的沟通，减少团队之间的沟通。为了做到这一点，应该将网站的巨石框架全面改造为面向服务架构，并提出一下要求：P60
    * 所有的团队都要以服务接口的方式，提供数据和各种功能。
    * 团队之间必须通过接口来通信。
    * 不允许任何其他形式的互操作：不允许直接读取其他团队的数据，不允许共享内存，不允许任何形式的后门。唯一许可的通信方式，就是通过网络调用服务。
    * 具体的实现技术不做规定，HTTP、Corba、Pub/Sub方式、自定义协议皆可。
    * 所有的服务接口，必须从一开始就以可以公开为设计导向，没有例外。这就是说，在设计接口的时候，就默认这个接口可以对外部人员开放，没有讨价还价的余地。
    * 如何不遵守上面的规定，就会被解雇。
2. 为了提升交付速度，获得持续交付能力，系统架构在设计时应该考虑如些因素。P61
    * 为测试而设计。如果我们每次写好代码之后，需要花费很大的精力，做很多的准备工作才能对它进行测试的话，那么从写好代码到完成质量验证就需要很长周期，当然无法快速发布。
    * 为部署而设计。如何我们开发完新功能，当部署发布时，需要花费很长时间做准备，甚至需要停机才能部署，当然就无法快速发布。
    * 为扩展而设计。这里的扩展性指两个方面，一是支持团队成员规模的扩展；而是支持系统自身的扩展。
    * 未失效而设计。在开发软件功能之前，就应该考虑一个问题是：一旦部署或发布失败，如何优雅且快速地处理。
3. 微核架构又称为插件架构，指的是软件的核心架构相对较小，而其主要业务功能和业务逻辑都通过插件实现。P62
    * 良好的功能延伸性：需要什么功能，开发一个插件即可。
    * 易发布：插件可以独立地加载和卸载，使它比较容易发布。
    * 易测试：功能之间是隔离的，可以对插件进行格力测试。
    * 可定制型高：适应不同的开发需要。
    * 可以渐进式地开发：逐渐增加功能。
4. 微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。P63
5. 